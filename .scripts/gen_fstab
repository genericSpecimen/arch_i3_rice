#!/bin/bash
# assumes partitions are named "boot", "swap", and "root"
PARTITIONS=($(blkid | awk '{print $1}' | sed 's/://'))
TYPES=($(blkid | awk '{print $3}' | grep -o '".*"' | sed 's/"//g'))
LABELS=($(blkid | awk '{print $4}' | grep -o '".*"' | sed 's/"//g'))
echo "# Generated by gen_fstab on $(date)" > test
echo >> test
for PART in "${!PARTITIONS[@]}"
do
	if [ "${LABELS["$PART"]}" == "boot" ]
	then
		echo "#${PARTITIONS["$PART"]}" >> test
		UUID=$(blkid -s UUID -o value ${PARTITIONS["$PART"]})
		TYPE=${TYPES["$PART"]}
		echo "UUID=$UUID	/boot	$TYPE	defaults,noatime	0 2" >> test
		echo >> test
	elif [ "${LABELS["$PART"]}" == "swap" ]
	then	
		echo "#${PARTITIONS["$PART"]}" >> test
		UUID=$(blkid -s PARTUUID -o value ${PARTITIONS["$PART"]})
		TYPE=${TYPES["$PART"]}
		echo "UUID=$UUID	none	$TYPE	defaults	0 0" >> test
		echo >> test
	elif [ "${LABELS["$PART"]}" == "root" ]
	then
		echo "#${PARTITIONS["$PART"]}" >> test
		UUID=$(blkid -s PARTUUID -o value ${PARTITIONS["$PART"]})
		TYPE=${TYPES["$PART"]}
		echo "UUID=$UUID	/	$TYPE	rw,noatime	0 1" >> test
		echo >> test
	fi
done
